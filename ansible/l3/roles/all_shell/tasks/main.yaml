---
- name: Build dotfiles user list
  ansible.builtin.set_fact:
    _dotfiles_users_effective: >-
      {{
        (dotfiles_users | default([]) | length > 0)
          | ternary(dotfiles_users, [dotfiles_user])
      }}

- name: Apply dotfiles per user
  ansible.builtin.include_tasks: dotfiles_user.yaml
  loop: "{{ _dotfiles_users_effective }}"
  loop_control:
    loop_var: dot_user
    label: "{{ dot_user }}"
