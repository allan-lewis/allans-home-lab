---
- name: Setup Uptime Kuma
  hosts: kuma_nodes
  become: yes
  gather_facts: false

  roles:
  - role: ../roles/util_directory
    vars:
      util_dirs: 
        - path: "{{ docker_volumes_directory }}/kuma"

  tasks:  
    - name: Setup Uptime Kuma
      community.docker.docker_container:
        container_default_behavior: no_defaults
        detach: yes
        name: "kuma"
        image: "louislam/uptime-kuma:1"
        state: "started"
        recreate: "yes"
        pull: "yes"
        restart_policy: "unless-stopped"
        volumes: 
          - "{{ docker_volumes_directory }}/kuma:/app/data"
        published_ports:
          - "{{ kuma_port }}:3001/tcp"
