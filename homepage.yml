---
- hosts: homepage_nodes
  become: yes
  gather_facts: false

  roles:
    - role: util_directory
      vars:
        util_dirs: 
        - path: "{{ docker_volumes_directory }}/homepage/icons"

  tasks:
    - name: Setup Homepage
      community.docker.docker_container:
        container_default_behavior: no_defaults
        detach: yes
        name: "homepage"
        image: "ghcr.io/benphelps/homepage:latest"
        state: "started"
        recreate: "yes"
        pull: "yes"
        restart_policy: "unless-stopped"
        published_ports: 
          - "{{ homepage_port }}:3000/tcp"
        volumes: 
          - "{{ docker_volumes_directory }}/homepage:/app/config"
          - "{{ docker_volumes_directory }}/homepage/icons:/app/public/icons"
          - /var/run/docker.sock:/var/run/docker.sock
