## AHL
---
- name: Install Guacamole and guacd.
  hosts: homelab_k8s_guacamole_nodes
  become: no
  gather_facts: no
  environment:
    K8S_AUTH_KUBECONFIG: "{{ homelab_k8s_kubeconfig_path }}"
  vars:
    homelab_k8s_namespace: "{{ homelab_k8s_guacamole_namespace | default('guacamole') }}"

  roles:
    # GUACD
    - role: k8s_generic_service
      vars:
        homelab_k8s_service_load_balancer_ip: "{{ homelab_k8s_guacd_load_balancer_ip }}"
        homelab_k8s_service_name: "{{ homelab_k8s_guacd_service_name | default('guacd') }}"
        homelab_k8s_service_port: "{{ homelab_k8s_guacd_service_port | default(35101) }}"
        homelab_k8s_service_target_port: "{{ homelab_k8s_guacd_service_target_port | default(4822) }}"
        homelab_k8s_service_template: "homelab-k8s-service-load-balancer.yaml.j2"
        homelab_k8s_container_name: "{{ homelab_k8s_guacd_container_name | default('guacd') }}"
        homelab_k8s_container_image: "{{ homelab_k8s_guacd_container_image | default('guacamole/guacd:' + homelab_versions.k8s_guacd) }}"
