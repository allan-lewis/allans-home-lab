## AHL
---
- name: Install Pi-hole.
  hosts: homelab_k8s_pihole_nodes
  become: no
  gather_facts: no
  environment:
    K8S_AUTH_KUBECONFIG: "{{ homelab_k8s_kubeconfig_path }}"

  roles:
    - role: k8s_generic_helm
      vars:
        homelab_k8s_service_name: "{{ homelab_k8s_pihole_service_name | default('pihole-web') }}"
        homelab_k8s_service_port: "{{ homelab_k8s_pihole_service_port | default(80) }}"
        homelab_k8s_helm_repo_name: "{{ homelab_k8s_pihole_helm_repo_name | default('mojo2600') }}"
        homelab_k8s_helm_repo_url: "{{ homelab_k8s_pihole_helm_repo_url | default('https://mojo2600.github.io/pihole-kubernetes/') }}"
        homelab_k8s_namespace: "{{ homelab_k8s_pihole_namespace | default('pihole')}}"
        homelab_k8s_helm_name: "{{ homelab_k8s_pihole_helm_name | default('pihole') }}"
        homelab_k8s_helm_chart_ref: "{{ homelab_k8s_pihole_helm_chart_ref | default('mojo2600/pihole') }}"
        homelab_k8s_helm_chart_version: "{{ homelab_k8s_pihole_helm_chart_version | default(homelab_versions.k8s_pihole) }}"
        homelab_k8s_helm_value_files:
          - src: "helm/pihole/homelab-k8s-helm-pilhole.yaml.j2"
            dest: "{{ homelab_k8s_pihole_helm_values_file | default('/tmp/pihole-values.yaml') }}"
        homelab_k8s_traefik_routes: "{{ homelab_k8s_pihole_traefik_routes }}"
