## AHL
---
- name: Install Tautulli.
  hosts: homelab_talos_management_nodes[0]
  become: no
  gather_facts: no
  environment:
    K8S_AUTH_KUBECONFIG: "{{ homelab_k8s_kubeconfig_path }}"

  roles:
    - role: getent
    - role: k8s_generic_service
      vars:
        homelab_k8s_namespace: "{{ homelab_k8s_tautulli_namespace | default('tautulli') }}"
        homelab_k8s_service_name: "{{ homelab_k8s_tautulli_service_name | default('tautulli') }}"
        homelab_k8s_container_name: "{{ homelab_k8s_tautulli_container_port | default('tautulli') }}"
        homelab_k8s_container_image: "{{ homelab_k8s_it_tools_container_image | default('lscr.io/linuxserver/tautulli:' + homelab_versions.k8s_tautulli) }}"
        homelab_k8s_service_port: "{{ homelab_k8s_it_tools_service_name | default(8181) }}"
        homelab_k8s_environment_vars:
          - name: TZ
            value: "{{ homelab_time_zone }}"
          - name: PUID
            value: "\"{{ homelab_user_id }}\""
          - name: PGID
            value: "\"{{ homelab_group_id }}\""
        homelab_k8s_volume_mounts:
          - name: tautulli-config
            path: /config  
        homelab_k8s_volumes:
          - name: tautulli-config
            claim: container-docker-tautulli
        homelab_k8s_traefik_routes:
          - host: "{{ homelab_k8s_tautulli_host }}"
