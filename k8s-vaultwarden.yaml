## AHL
---
- name: Install Vaultwarden.
  hosts: homelab_k8s_vaultwarden_nodes
  become: no
  gather_facts: no
  environment:
    K8S_AUTH_KUBECONFIG: "{{ homelab_k8s_kubeconfig_path }}"

  roles:
    - role: k8s_generic_service
      vars:
        homelab_k8s_namespace: "{{ homelab_k8s_vaultwarden_namespace | default('vaultwarden') }}"
        homelab_k8s_service_name: "{{ homelab_k8s_vaultwarden_service_name | default('vaultwarden') }}"
        homelab_k8s_service_port: "{{ homelab_k8s_vaultwarden_service_port | default(35500) }}"
        homelab_k8s_service_target_port: "{{ homelab_k8s_vaultwarden_service_target_port | default(80) }}"
        homelab_k8s_container_name: "{{ homelab_k8s_vaultwarden_container_name | default('vaultwarden') }}"
        homelab_k8s_container_image: "{{ homelab_k8s_vaultwarden_container_image | default('vaultwarden/server:' + homelab_versions.k8s_vaultwarden) }}"
        homelab_k8s_environment_vars:
          - name: ADMIN_TOKEN
            value: "{{ homelab_k8s_vaultwarden_admin_token }}"
        homelab_k8s_volume_mounts:
          - name: vaultwarden-data
            path: /data  
        homelab_k8s_volumes:
          - name: vaultwarden-data
            claim: vaultwarden
        homelab_k8s_traefik_routes: "{{ homelab_k8s_vaultwarden_routes }}"
