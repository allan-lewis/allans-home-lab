---
- hosts: mariadb_nodes
  become: yes
  gather_facts: false

  vars: 
    mariadb_config_volume: "{{ docker_volumes_directory }}/mariadb"
    
  roles:
    - role: util_getent
    - role: util_directory
      vars:
        util_dirs:        
          - path: "{{ mariadb_config_volume }}"

  tasks:
    - name: Setup MariaDB
      community.docker.docker_container:
        container_default_behavior: no_defaults
        detach: yes
        name: "mariadb"
        image: "lscr.io/linuxserver/mariadb"
        state: "started"
        recreate: "yes"
        pull: "yes"
        restart_policy: "unless-stopped"
        published_ports: 
          - "{{ mariadb_port}}:3306/tcp"
        volumes: 
          - "{{ mariadb_config_volume }}:/config"
        env: 
          TZ: America/New_York
          PUID: "{{ control_uid }}"
          PGID: "{{ control_gid }}"
          MYSQL_ROOT_PASSWORD:  "{{ mariadb_root_password }}"
