---
- hosts: mediawiki_nodes
  become: yes
  gather_facts: false

  vars:
    mediawiki_volume: "{{ docker_volumes_directory }}/mediawiki"

  roles:    
    - role: ahl_mkdir
      vars:
        dir_items:
          - path: "{{ mediawiki_volume }}"
          - path: "{{ mediawiki_volume }}/images"

  tasks:
    - name: Setup Mediawiki
      community.docker.docker_container:
        container_default_behavior: no_defaults
        detach: yes
        name: "mediawiki"
        image: "mediawiki"
        state: "started"
        recreate: "yes"
        pull: "yes"
        restart_policy: "unless-stopped"
        published_ports: 
          - "{{ mediawiki_http_port}}:80/tcp"
        volumes: 
          - "{{ mediawiki_volume }}/images:/var/www/html/images"
          - "{{ mediawiki_volume }}/LocalSettings.php:/var/www/html/LocalSettings.php" 
