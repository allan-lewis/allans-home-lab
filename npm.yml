---
- name: Setup Nginx Proxy Manager
  hosts: npm_nodes
  become: yes
  gather_facts: false

  vars:
    npm_data_volume: "{{ docker_volumes_directory }}/npm/data"
    npm_letsencrypt_volume: "{{ docker_volumes_directory }}/npm/letsencrypt"

  roles:
    - role: util_directory
      vars:
        util_dirs: 
          - path: "{{ npm_data_volume }}"
          - path: "{{ npm_letsencrypt_volume }}"

  tasks:
    - name: Setup Nginx Proxy Manager
      community.docker.docker_container:
        container_default_behavior: no_defaults
        detach: yes
        name: "npm"
        image: "jc21/nginx-proxy-manager"
        state: "started"
        recreate: "yes"
        pull: "yes"
        network_mode: host
        restart_policy: "unless-stopped"
        volumes:
          - "{{ npm_data_volume }}:/data"
          - "{{ npm_letsencrypt_volume }}:/etc/letsencrypt"
