---
- hosts: pihole_nodes
  become: yes
  gather_facts: false

  tasks:

    - name: Disabling the default DNS service
      ansible.builtin.service:
        name: systemd-resolved
        state: stopped
        enabled: no

    - name: Ensuring that resolv.conf has the correct contents
      ansible.builtin.template:
        src: resolv.conf.j2
        dest: /etc/resolv.conf
        owner: root
        group: root
        mode: 0644

    - name: Setting up Docker container(s)
      ansible.builtin.include_role:
        name: container
      vars:
        container: "{{ item }}"
      with_items:
        - "{{ pihole_container }}"
