- name: Ensure that control node SSH keys are authorized on all managed nodes
  ansible.posix.authorized_key:
    user: "{{ ansible_ssh_user }}"
    state: present
    key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"

- name: Ensure that we're controlling things as the {{ control_user }} user
  ansible.builtin.assert:
    that: "ansible_ssh_user == '{{ control_user }}'"
    fail_msg: "Not proceeding further since we're using user {{ ansible_ssh_user }} instead of {{ control_user }}"
    success_msg: "Proceeding because we're using user {{ ansible_ssh_user }}"

- name: Ensure that managed nodes are ping-able
  ansible.builtin.ping:
  
