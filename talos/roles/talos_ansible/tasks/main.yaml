## AHL
---
- name: Install Ansible.
  ansible.builtin.pip:
    name: ansible
    extra_args: --user

- name: Create an Ansibile config file.
  ansible.builtin.template:
    src: ansible.cfg.j2
    dest: "{{ ansible_env.HOME }}/.ansible.cfg"

- name: Add host keys for all Talos management nodes.
  ansible.builtin.known_hosts:
    name: "{{ hostvars[item].ansible_host }}"
    key: "{{ lookup('pipe', 'ssh-keyscan {{ hostvars[item].ansible_host }},`dig +short {{ hostvars[item].ansible_host }}`') }}"
  with_items: "{{ groups['talos_management_nodes'] }}"
