## AHL
---
- name: Check for config file existence
  ansible.builtin.stat:
    path: "{{ talos_config_file }}"
  register: stat_result

- name: Display the config file result
  ansible.builtin.debug:
    var: stat_result

- name: Generate config for cluster
  when: "not stat_result.stat.exists"
  ansible.builtin.command: talosctl gen config talos-proxmox-cluster https://{{ talos_control_plane_ip }}:6443 --output-dir {{ talos_config_directory }} --install-image factory.talos.dev/installer/ce4c980550dd2ab1b17bbf2b08801c7eb59418eafe8f279833297925d67c7515:{{ talos_version }}
  changed_when: true
